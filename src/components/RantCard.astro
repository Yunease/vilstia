---
import type { CollectionEntry } from "astro:content";

interface Props {
	entry: CollectionEntry<"posts">;
	class?: string;
	style?: string;
}

const { entry, class: className, style } = Astro.props;

//此处做过改动，请在RantPage.astro中查看，有详细的注释。
const MOOD_COLORS: { [key: string]: string } = {
	焦躁: "#E06C75",
	消沉: "#7F8C8D",
	怨恨: "#C792EA",
	开心: "#3CB371",
	平和: "#FFB6C1",
	振奋: "#F4A460",
};

const mood = entry.data.mood || "烦躁";
const moodColor = MOOD_COLORS[mood] || "#F6C177";

const publishedDate = entry.data.published;

// Format date: YYYY.MM.DD
const dateStr = publishedDate
	.toLocaleDateString("zh-CN", {
		year: "numeric",
		month: "2-digit",
		day: "2-digit",
	})
	.replace(/\//g, ".");

// Format time: HH:MM
// Since published is already a Date object (from z.date() schema),
// we can directly get the hours and minutes from it
const hours = publishedDate.getUTCHours().toString().padStart(2, "0");
const minutes = publishedDate.getUTCMinutes().toString().padStart(2, "0");
const timeStr = `${hours}:${minutes}`;
---

<div class:list={["flex gap-4 onload-animation", className]} {style}>
	<!-- Timeline (left side) -->
	<div class="flex flex-col items-center min-w-[4.5rem]">
		<div class="flex flex-col items-center gap-1">
			<div class="w-3 h-3 rounded-full bg-[var(--primary)] relative z-10"></div>
			<div class="text-xs font-medium text-[var(--primary)] tracking-wider">
				{dateStr}
			</div>
			<div class="text-xs font-light text-[var(--text-neutral)] opacity-80">
				{timeStr}
			</div>
		</div>
		<div class="w-px h-full bg-gradient-to-b from-[var(--primary)] to-transparent mt-3"></div>
	</div>

	<!-- Content card -->
	<div
		class="flex-1 rounded-[var(--radius-large)] bg-[var(--card-bg)] p-4 transition hover:bg-[var(--btn-card-bg-hover)]"
	>
		<div class="flex items-center gap-2 mb-2">
			<span
				class="text-sm font-bold px-2 py-0.5 rounded-full"
				style={`color: ${moodColor}; background-color: ${moodColor}15;`}
			>
				{mood}
			</span>
		</div>
		<div class="text-[var(--text-neutral)] dark:text-white leading-relaxed whitespace-pre-wrap">
			{entry.body}
		</div>
	</div>
</div>
